---
title: フレームワーク統合
description: React など framework との統合パターン、Promise ベースの待機、UI アニメーション連携
---

import { Code } from '@astrojs/starlight/components';
import ReactPlayerDemo from '../../../components/demo/ReactPlayerDemo.tsx';
import { reactPlayerDemo } from '../../../snippets/examples/react-integration';
import { reactHookPlayer, reactHookFn, promiseWaitPlayer, promiseWaitFn, smoothAnimationPlayer, smoothAnimationFn } from '../../../snippets/examples/framework-integration';

React など framework との統合パターンや、Promise ベースの待機、UI アニメーション連携について説明します。

**使用モジュール**: `adapters`, `play`

## React デモ

React で waa-play を使用する実動デモです。`useSyncExternalStore` と `subscribeSnapshot` / `getSnapshot` を使って、再生状態をリアクティブに管理します。

<ReactPlayerDemo client:load locale="ja" />

### デモのソースコード

このデモのコアロジックです。UI の描画コードは省略しています。

<Code code={reactPlayerDemo} lang="tsx" />

## コード例

### 1. React カスタムフック

`subscribeSnapshot` と `getSnapshot` は React の `useSyncExternalStore` と直接互換性があります。

<Code code={reactHookPlayer} lang="tsx" />

**解説**: `subscribeSnapshot` は `statechange`, `timeupdate`, `seek`, `ended` イベントを購読し、変更時に callback を呼びます。`getSnapshot` は immutable な snapshot を返します。この2つの関数は `useSyncExternalStore` の subscribe / getSnapshot パラメータにそのまま対応します。

<details>
<summary>関数 API 版</summary>

<Code code={reactHookFn} lang="tsx" />

</details>

### 2. Promise ベース待機

再生完了やポジション到達を Promise で待機できます。

<Code code={promiseWaitPlayer} lang="ts" />

**解説**: `whenEnded` は `ended` イベント（自然終了）で resolve する Promise を返します。手動 `stop()` では resolve されません。`whenPosition` は `timeupdate` イベントを監視し、指定ポジションに到達（または超過）したら resolve します。

<details>
<summary>関数 API 版</summary>

<Code code={promiseWaitFn} lang="ts" />

</details>

### 3. スムーズ UI アニメーション

`onFrame` で `requestAnimationFrame` ベースのスムーズな progress bar・seeker 更新が可能です。

<Code code={smoothAnimationPlayer} lang="ts" />

**解説**: `onFrame` は `requestAnimationFrame` ループを内部で管理し、毎フレーム `PlaybackSnapshot` を callback に渡します。戻り値の関数を呼ぶとループが停止します。`timeupdate`（setInterval ベース、デフォルト 50ms）より滑らかな更新が可能です。

**`timeupdate` イベントとの違い**: `timeupdate` は `setInterval` ベースでバックグラウンドタブでも動作します。`onFrame` は `requestAnimationFrame` ベースで視覚更新に最適ですがバックグラウンドでは停止します。

<details>
<summary>関数 API 版</summary>

<Code code={smoothAnimationFn} lang="ts" />

</details>

## 関連 API

- [WaaPlayer](/waa/api/player/)
- [関数 API](/waa/api/functions/)
