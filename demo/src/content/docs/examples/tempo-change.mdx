---
title: テンポ変更
description: テンポの変更やバッファリング状態の監視パターンを紹介します
---

import { Code } from '@astrojs/starlight/components';
import TempoDemo from '../../../components/demo/TempoDemo.astro';
import ChunkBufferingDemo from '../../../components/demo/ChunkBufferingDemo.astro';
import { tempoChangePlayer, tempoChangeFn, bufferingMonitorPlayer, bufferingMonitorFn } from '../../../snippets/examples/tempo-and-rhythm';

テンポの変更やバッファリング状態の監視パターンを紹介します。

**使用モジュール**: `play`, `stretcher`

## テンポ変更デモ

WSOLA ベースの pitch 保持 time-stretch 機能のデモです。テンポスライダーでリアルタイムに再生速度を変更できます。

<TempoDemo locale="ja" />

## チャンクバッファリングデモ

WSOLA stretcher エンジンのチャンクバッファリングの仕組みを観察するデモです。各チャンクの処理状態やイベントログをリアルタイムに確認できます。

<ChunkBufferingDemo locale="ja" />

## コード例

### 1. Pitch 保存テンポ変更

`preservePitch` のデフォルトは `true` なので、通常の `play()` 呼び出しでピッチが保存されます。通常速度変更（ピッチも変わる）には `preservePitch: false` を明示します。

<Code code={tempoChangePlayer} lang="ts" />

WSOLA アルゴリズムにより、ピッチを変えずにテンポを変更できます。`preservePitch: true`（デフォルト）で WSOLA ベースの time-stretch が有効になります。

<details>
<summary>関数 API 版</summary>

<Code code={tempoChangeFn} lang="ts" />

</details>

### 2. Buffering 状態の監視

WSOLA 処理は非同期で行われるため、テンポ変更時に buffering が発生する可能性があります。

<Code code={bufferingMonitorPlayer} lang="ts" />

`buffering` イベントの `reason` は `"initial"` | `"seek"` | `"tempo-change"` | `"underrun"` のいずれかです。`getSnapshot()` の `stretcher` フィールドで詳細な状態を取得できます。

<details>
<summary>関数 API 版</summary>

<Code code={bufferingMonitorFn} lang="ts" />

</details>

## 関連 API

- [WaaPlayer](/waa/api/player/)
- [関数 API](/waa/api/functions/)
- [Stretcher](/waa/api/stretcher/)
