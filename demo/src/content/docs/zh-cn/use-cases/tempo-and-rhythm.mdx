---
title: 节奏与韵律
description: 介绍节奏控制模式，包括节奏变更和节奏模式构建等时序控制。
---

import { Code } from '@astrojs/starlight/components';
import { tempoChangePlayer, tempoChangeFn, bufferingMonitorPlayer, bufferingMonitorFn, beatSequencerPlayer, beatSequencerFn } from '../../../../snippets/use-cases/tempo-and-rhythm';

介绍节奏控制模式，包括节奏变更和节奏模式构建等时序控制。

**使用模块**: `play`, `scheduler`, `synth`

## 1. 保持音高的节奏变更

由于 `preservePitch` 默认为 `true`，因此在正常的 `play()` 调用中会自动保持音高。如需常规速度变更（音高也会改变），请明确设置 `preservePitch: false`。

<Code code={tempoChangePlayer} lang="ts" />

WSOLA 算法允许在不改变音高的情况下改变节奏。设置 `preservePitch: true`（默认）将启用基于 WSOLA 的时间拉伸。

<details>
<summary>函数 API 版</summary>

<Code code={tempoChangeFn} lang="ts" />

</details>

## 2. 监控缓冲状态

由于 WSOLA 处理是异步的，因此在改变节奏时可能会发生缓冲。

<Code code={bufferingMonitorPlayer} lang="ts" />

`buffering` 事件中的 `reason` 为 `"initial"` | `"seek"` | `"tempo-change"` | `"underrun"` 之一。您可以通过 `getSnapshot()` 中的 `stretcher` 字段获取详细状态信息。

<details>
<summary>函数 API 版</summary>

<Code code={bufferingMonitorFn} lang="ts" />

</details>

## 3. 节拍序列器

您可以使用时钟和调度器以精确的时序构建节拍模式。

<Code code={beatSequencerPlayer} lang="ts" />

使用 `createClock` 创建基于 BPM 的时钟，通过 `createScheduler` 的前瞻调度实现采样精确的时序控制。您可以使用 `createClickBuffer` 合成咔嗒声。

<details>
<summary>函数 API 版</summary>

<Code code={beatSequencerFn} lang="ts" />

</details>

## 相关 API

- [WaaPlayer](/waa/api/player/)
- [函数 API](/waa/api/functions/)
- [Stretcher](/waa/api/stretcher/)
