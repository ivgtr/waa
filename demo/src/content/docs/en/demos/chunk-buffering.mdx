---
title: Chunk Buffering
description: Visualize the chunk buffering behavior of the WSOLA stretcher engine
---

import ChunkBufferingDemo from '../../../../components/demo/ChunkBufferingDemo.astro';

A demo to observe the chunk buffering mechanism of the WSOLA stretcher engine.

- **Chunk strip**: Real-time display of each chunk's processing state (pending → queued → converting → ready)
- **Legend**: See what each color represents
- **Event log**: Real-time recording of buffering start/end, chunk transitions, and buffer health changes
- **Tempo slider**: Observe chunk rescheduling when changing tempo
- **Seek**: Click the waveform to see chunks loading from the new position

<ChunkBufferingDemo locale="en" />

## Code Examples

### Getting Stretcher Snapshot

```ts
import { WaaPlayer } from "waa-play";

const player = new WaaPlayer();
const buffer = await player.load("/music.mp3");

const playback = player.play(buffer, {
  playbackRate: 1.0,
  preservePitch: true,
});

const stop = player.onFrame(playback, (snapshot) => {
  const { stretcher } = snapshot;
  if (stretcher) {
    console.log(`Chunk states: ${stretcher.chunkStates.join(", ")}`);
    console.log(`Current chunk: #${stretcher.currentChunkIndex}`);
    console.log(`Buffer health: ${stretcher.bufferHealth}`);
    console.log(`Buffering: ${stretcher.buffering}`);
    console.log(`Ahead: ${stretcher.aheadSeconds.toFixed(1)}s`);
  }
});
```
