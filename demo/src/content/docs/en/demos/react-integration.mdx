---
title: React Integration
description: Interactive demo of using waa-play with React
---

import ReactPlayerDemo from '../../../../components/demo/ReactPlayerDemo.tsx';

A working demo of waa-play with React. Uses `useSyncExternalStore` with `subscribeSnapshot` / `getSnapshot` to reactively manage playback state.

<ReactPlayerDemo client:load locale="en" />

## Source Code

The complete source code of this demo.

```tsx
import { useState, useMemo, useSyncExternalStore, useRef } from "react";
import { WaaPlayer, getSnapshot, subscribeSnapshot } from "waa-play";
import type { Playback, PlaybackSnapshot, PeakPair } from "waa-play";

function usePlaybackSnapshot(playback: Playback | null): PlaybackSnapshot | null {
  return useSyncExternalStore(
    (cb) => (playback ? subscribeSnapshot(playback, cb) : () => {}),
    () => (playback ? getSnapshot(playback) : null),
  );
}

function Player({ buffer }: { buffer: AudioBuffer }) {
  const playerRef = useRef(new WaaPlayer());
  const [playback, setPlayback] = useState<Playback | null>(null);
  const snap = usePlaybackSnapshot(playback);
  const peaks = useMemo(
    () => playerRef.current.extractPeakPairs(buffer, { resolution: 200 }),
    [buffer],
  );

  return (
    <div>
      <Waveform peaks={peaks} progress={snap?.progress ?? 0} />
      <button
        onClick={() => {
          if (!playback) {
            setPlayback(playerRef.current.play(buffer));
          } else {
            playback.togglePlayPause();
          }
        }}
      >
        {snap?.state === "playing" ? "Pause" : "Play"}
      </button>
      <span>
        {snap?.position.toFixed(1)}s / {snap?.duration.toFixed(1)}s
      </span>
    </div>
  );
}
```

## Key Points

- **`useSyncExternalStore`**: React 18+ official API for subscribing to external stores
- **`subscribeSnapshot`**: Subscribe to Playback state changes
- **`getSnapshot`**: Get the current `PlaybackSnapshot` (state, position, duration, progress)
- **`onFrame`**: `requestAnimationFrame`-based frame loop (for visualizers, etc.)
